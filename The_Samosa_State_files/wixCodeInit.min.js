define("wixCodeInit",["lodash","coreUtils","platformInit","host-platform-api"],function(e,t,r,n){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1947)}({0:function(t,r){t.exports=e},1:function(e,r){e.exports=t},1947:function(e,t,r){var n,o;n=[r(1948),r(1951),r(48)],void 0===(o=function(e,t,r){"use strict";return{getAppApi:e.getApi,initMainR:t,appsUtils:r.appsUtils,specMapUtils:r.specMapUtils,registerDeps:r.registerDeps}}.apply(t,n))||(e.exports=o)},1948:function(e,t,r){var n,o;n=[r(0),r(48),r(1),r(1949),r(1950),r(86)],void 0===(o=function(e,t,r,n,o,i){"use strict";function a(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments[2],i=!!t.publicModel,a="undefined"!=typeof window&&!window.clientSideRender,d="undefined"==typeof window||window.isPseudoWindow,c=t.wixBiSession,u=c.visitorId,p={viewerSessionId:c.viewerSessionId,visitorId:u,initialTimestamp:c.initialTimestamp,ownerId:t.rendererModel.userId,deviceType:n.isMobileView?"mobile":"desktop",renderCycle:a&&!d?2:1,renderingEnv:d?"backend":"browser",userWarmup:t.userWarmup,locale:t.rendererModel.languageCode,sdkSource:n.sdkSource,namespacesSdkSource:n.namespacesSdkSource,externalComponentsSource:n.externalComponentsSource,wixCodeNamespacesAndElementorySupportSource:n.wixCodeNamespacesAndElementorySupportSource,openExperiments:(r=t.rendererModel.runningExperiments,e.reduce(r,function(e,t,r){return"new"===t&&e.push(r),e},[])),applications:JSON.stringify(n.applications),metaSiteId:t.rendererModel.metaSiteId};return p=s(t)?e.merge(p,{compId:"wixCode_"+o.appDefinitionId,viewMode:i?"site":"preview"}):e.merge(p,{viewMode:i?"site":t.renderFlags.componentViewMode||"preview"})}function s(t){var r=t.rendererModel.clientSpecMap.toJS?t.rendererModel.clientSpecMap.toJS():t.rendererModel.clientSpecMap;return!!t.rendererModel.wixCodeModel&&e.some(r,{type:"siteextension"})}return{getApi:function(){var e=[],d=[],c=t.messageProxy.get(),u=!1,p=!0,l=null,f=null,m=null,g=void 0,v=void 0;return{init:function(d,p,l){if(u)console.warn("Wix code is already initiated");else{var f=t.appsUtils.getAppsBaseInfo({clientSpecMap:p,serviceTopology:d.serviceTopology,rendererModel:d.rendererModel}).length>0;if(s(d)){var m=t.specMapUtils.getAppSpec(p),w=n.buildUrl(d,m,l);g=o.getIFrameForApp(w,m),v=a(d,l,m)}else{if(!f)return;var M=n.buildStaticUrl(d,l);g=o.getIFrameForApp(M,{}),v=a(d,l)}var S=function(r,n){var a;o.isIFrameEvent(r,n)&&("PLATFORM_IFRAME"!==(a=n.data).intent&&"WIX_CODE"!==a.intent||"wix_code_iframe_initialized"!==a.type||r.contentWindow.postMessage(i.messageBuilder.setBootstrapParametersMessage(v),"*"),function(e){return("PLATFORM_IFRAME"===e.intent||"WIX_CODE"===e.intent)&&"wix_code_iframe_loaded"===e.type}(n.data)&&c.setMessageHandler(function(e){r.contentWindow.postMessage(e,"*")}),t.biUtils.shouldUseFallbackReportBI(n.data,e)&&t.biUtils.reportBiWithWixBiSession(n.data),e.forEach(function(e){e(n.data)}))}.bind(null,g);window.addEventListener("message",S,!1),function(e){function t(){var t=window.document.body;t.insertBefore(e,t.firstChild),r.loggingUtils.performance.mark("platform-iframe-added-to-dom")}"loading"!==window.document.readyState?t():window.document.addEventListener("DOMContentLoaded",function(){t()})}(g),u=!0}},destroyAppsContainer:function(){g&&(g.parentNode.removeChild(g),u=!1,c=t.messageProxy.get(),g=void 0)},sendMessage:function(e){e&&c.sendOrHoldMessage(function(e){return d.reduce(function(e,t){return t(e)},e)}(e))},registerMessageHandler:function(t){e.push(t)},registerMessageModifier:function(e){d.push(e)},unregisterMessageHandler:function(t){var r=e.indexOf(t);-1!==r&&e.splice(r,1)},preLoadWidgets:function(e,r){!l&&s(e)&&t.widgetsPreLoader.asyncGetPreLoadMessage(e,r,function(e){p&&!l&&(l=e,c.sendOrHoldMessage(l))})},preLoadUserCode:function(e,r){(!f&&s(e)||t.appsUtils.getAppsBaseInfo({clientSpecMap:e.rendererModel.clientSpecMap,serviceTopology:e.serviceTopology,rendererModel:e.rendererModel}))&&t.widgetsPreLoader.asyncGetPreLoadUserCodeMessage(e,r,function(e){f||(f=e,c.sendOrHoldMessage(f))})},preInitWidgets:function(e,r){!m&&s(e)&&t.widgetsPreLoader.asyncGetPreInitMessage(e,r,function(e){m||(m=e,c.sendOrHoldMessage(m))})},isAppInitiated:function(){return u},getAppsIframe:function(){return g}}}}}.apply(t,n))||(e.exports=o)},1949:function(e,t,r){var n;void 0===(n=function(){"use strict";function e(){for(var e=arguments[0],t=1;t<arguments.length;++t)e=e.replace(/\/$/,"")+"/"+arguments[t].replace(/^\//,"");return e}function t(e,t){var r,n=e.serviceTopology,o=(r=e.santaBase,/^https?:\/\/localhost(:[0-9]+)?\/?$/.test(r)||function(e){return/^https?:\/\/s3.amazonaws.com\/integration-tests-statics\/(.+)\/SNAPSHOT\/santa?$/.test(e)}(e.santaBase)?n.scriptsLocationMap.santa:e.santaBase);return o=function(e,t){var r=e.lastIndexOf("/");return/^\d+\.\d+\.\d+$/.test(t)?e.substring(0,r+1)+t:e}(o,t),/(.*\/services\/)?(.*)/.exec(o)[2]}function r(){if("function"!=typeof URLSearchParams&&"undefined"!=typeof window)return!1;var e=void 0;try{e=window.parent.location.search}catch(t){e=""}return(new URLSearchParams(e).get("debug")||"").includes("localWorker")}return{buildUrl:function(n,o){return function(n,o,i,a){if(r())return"//localhost/node_modules/santa-wix-code";var s=a?"pub":"dev",d="//"+o.instanceId+"."+s+".",c=n.serviceTopology.wixCloudBaseDomain,u="node_modules/santa-wix-code/"+(i.useWixCodeFallback?"fallback.html":"index.html");return d+e(c,"_partials",t(n,i.runtimeSource),u)}(n,o,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},!!n.publicModel)},buildStaticUrl:function(n){return function(n,o){if(r())return"//localhost/node_modules/santa-wix-code";var i="//editor."+n.serviceTopology.serverName+"/",a="node_modules/santa-wix-code/"+(o.useWixCodeFallback?"fallback.html":"index.html");return i+e("_partials",t(n,o.runtimeSource),a)}(n,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}}}.apply(t,[]))||(e.exports=n)},1950:function(e,t,r){var n,o;n=[r(0)],void 0===(o=function(e){"use strict";return{getIFrameForApp:function(t,r){var n=window.document.createElement("iframe");return n.style.cssText="position: fixed; left: 0; right: 0; top: 0; bottom: 0; width: 1px; height: 1px; background: transparent; border: 0",n.tabIndex=-1,n.setAttribute("aria-hidden","true"),n.src=t,e.get(r,"applicationId")&&e.get(r,"appDefinitionId")&&(n.setAttribute("data-app-id",r.applicationId),n.setAttribute("data-app-definition-id",r.appDefinitionId)),n},isIFrameEvent:function(e,t){return t.source===e.contentWindow}}}.apply(t,n))||(e.exports=o)},1951:function(e,t,r){var n,o;n=[r(0),r(48)],void 0===(o=function(e,t){"use strict";return function(e){var r=e.appApi,n=e.siteModel,o=e.isMobileView,i=e.queryUtil,a=e.currentUrl,s=e.isBot;a=a||window.document.location.href;var d,c=t.wixCodeUrlUtils.buildScriptsSources(n.serviceTopology,{isDebug:i.getParameterByName("debug")}),u=c.sdkSource,p=c.namespacesSdkSource,l=c.externalComponentsSource,f=c.wixCodeNamespacesAndElementorySupportSource,m=(w=i.getParameterByName("useWixCodeFallback"),"false"!==w&&("true"===w||!window.Worker||s)),g={isMobileView:o,sdkSource:u,namespacesSdkSource:p,externalComponentsSource:l,wixCodeNamespacesAndElementorySupportSource:f,runtimeSource:i.getParameterByName("WixCodeRuntimeSource"),ReactSource:i.getParameterByName("ReactSource"),useWixCodeFallback:m},v=i.getParameterByName("viewerPlatformAppSources");var w;g.applications=t.appsUtils.getAppsBaseInfo({rendererModel:n.rendererModel,clientSpecMap:n.rendererModel.clientSpecMap,serviceTopology:n.serviceTopology,viewerPlatformAppSources:v,currentUrl:a,santaBase:n.santaBase}),d=n.rendererModel.clientSpecMap,r.init(n,d,g),function(e){return t.specMapUtils.getAppSpec(e)||g.applications.length}(d)&&(r.preLoadUserCode(n,a),n.publicModel&&r.preLoadWidgets(n,a))}}.apply(t,n))||(e.exports=o)},48:function(e,t){e.exports=r},86:function(e,t){e.exports=n}})});
//# sourceMappingURL=wixCodeInit.min.js.map